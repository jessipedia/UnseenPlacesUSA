var url = "http://localhost:3000/api/places";
var placeData = [];
//var stateShapes = "./viz/states.json";

let stateGeo =
{"type":"Feature",
  "properties":
    {"Name":"Alabama",
    "STATEFP":"01",
    "STATENS":"01779775",
    "AFFGEOID":"0400000US01",
    "GEOID":"01",
    "STUSPS":"AL",
    "LSAD":"00",
    "ALAND":"131173688951",
    "AWATER":"4593686489"},
  "geometry":
    {"type":"MultiPolygon",
    "coordinates":[[[[-88.043743,30.517423,0],[-88.05325,30.506161,0],[-88.025917,30.490801,0],[-88.024729,30.503089,0],[-88.024729,30.516399,0],[-88.036613,30.520494,0],[-88.043743,30.517423,0]]],[[[-88.267271,30.353806,0],[-88.273213,30.333294,0],[-88.257764,30.318933,0],[-88.248256,30.326114,0],[-88.248256,30.346627,0],[-88.250633,30.367136,0],[-88.261329,30.372263,0],[-88.267271,30.353806,0]]],[[[-88.330758,30.235026,0],[-88.324659,30.22317,0],[-88.305346,30.221413,0],[-88.279426,30.222291,0],[-88.207765,30.236783,0],[-88.166597,30.241173,0],[-88.144743,30.238978,0],[-88.107331,30.225076,0],[-88.092903,30.240734,0],[-88.078786,30.245039,0],[-88.075856,30.246139,0],[-88.074854,30.249119,0],[-88.086812,30.259864,0],[-88.124658,30.28364,0],[-88.124722,30.273541,0],[-88.130631,30.262125,0],[-88.143727,30.260491,0],[-88.158974,30.257857,0],[-88.177779,30.257857,0],[-88.225553,30.250833,0],[-88.261638,30.244686,0],[-88.288574,30.238539,0],[-88.30433,30.237661,0],[-88.330758,30.235026,0]]],[[[-88.473227,31.893856,0],[-88.472642,31.875153,0],[-88.471214,31.851385,0],[-88.471106,31.850949,0],[-88.468669,31.790722,0],[-88.465107,31.722312,0],[-88.4644269792809,31.6979519029488,0],[-88.464425,31.697881,0],[-88.459722,31.624002,0],[-88.459478,31.621652,0],[-88.453013,31.500164,0],[-88.451575,31.481533,0],[-88.451045,31.459448,0],[-88.4495695963996,31.4358347375977,0],[-88.44866,31.421277,0],[-88.448686,31.420888,0],[-88.445209,31.355969,0],[-88.445182,31.355855,0],[-88.43878,31.252654,0],[-88.43898,31.246896,0],[-88.438211,31.231252,0],[-88.438104,31.23006,0],[-88.432007,31.114298,0],[-88.425807,31.001123,0],[-88.425729,31.000183,0],[-88.4256361537673,30.9983011286609,0],[-88.419562,30.875186,0],[-88.41863,30.866528,0],[-88.4124506012791,30.7355976173844,0],[-88.41227,30.731771,0],[-88.412209,30.730395,0],[-88.41155,30.712956,0],[-88.411339,30.706334,0],[-88.409571,30.668731,0],[-88.40807,30.63697,0],[-88.407462,30.631653,0],[-88.407484,30.622736,0],[-88.404013,30.54506,0],[-88.403931,30.543359,0],[-88.403547,30.5331,0],[-88.402283,30.510852,0],[-88.395023,30.369425,0],[-88.374671,30.385608,0],[-88.364022,30.388006,0],[-88.341345,30.38947,0],[-88.332277,30.38844,0],[-88.319599,30.380334,0],[-88.316525,30.369985,0],[-88.311608,30.368908,0],[-88.290649,30.370741,0],[-88.282635,30.382876,0],[-88.260695,30.382381,0],[-88.204495,30.362102,0],[-88.200065,30.362378,0],[-88.188527,30.348124,0],[-88.188532,30.345053,0],[-88.196353,30.343586,0],[-88.198361,30.338819,0],[-88.195664,30.321242,0],[-88.191542,30.317002,0],[-88.171967,30.324679,0],[-88.155775,30.327184,0],[-88.136173,30.320729,0],[-88.128052,30.338509,0],[-88.124611,30.341623,0],[-88.115432,30.35657,0],[-88.107274,30.377246,0],[-88.10407,30.4273,0],[-88.106437,30.452738,0],[-88.100646,30.46122,0],[-88.096867,30.471053,0],[-88.102988,30.493029,0],[-88.103768,30.500903,0],[-88.100874,30.50975,0],[-88.090734,30.52357,0],[-88.082792,30.528713,0],[-88.081617,30.546317,0],[-88.085493,30.563258,0],[-88.074898,30.578892,0],[-88.064898,30.588292,0],[-88.053998,30.612491,0],[-88.059598,30.619091,0],[-88.061998,30.644891,0],[-88.044339,30.652568,0],[-88.034588,30.653715,0],[-88.026706,30.66149,0],[-88.022076,30.673873,0],[-88.012444,30.68319,0],[-88.008396,30.684956,0],[-87.981196,30.67509,0],[-87.955989,30.658862,0],[-87.936717,30.657432,0],[-87.93107,30.652694,0],[-87.919346,30.63606,0],[-87.91253,30.615795,0],[-87.914956,30.585893,0],[-87.911431,30.576261,0],[-87.907891,30.573114,0],[-87.904168,30.565985,0],[-87.901711,30.550879,0],[-87.905343,30.537566,0],[-87.911141,30.525848,0],[-87.933355,30.487357,0],[-87.931902,30.4811,0],[-87.924211,30.4761,0],[-87.920031,30.470645,0],[-87.914136,30.446144,0],[-87.908908,30.41424,0],[-87.906343,30.40938,0],[-87.865017,30.38345,0],[-87.853806,30.378481,0],[-87.845132,30.377446,0],[-87.837239,30.369324,0],[-87.82988,30.353809,0],[-87.809266,30.332702,0],[-87.796717,30.324198,0],[-87.772758,30.311701,0],[-87.755516,30.291217,0],[-87.755263,30.277292,0],[-87.766626,30.262353,0],[-87.78775,30.254244,0],[-87.802087,30.253054,0],[-87.817743,30.254292,0],[-87.860085,30.240289,0],[-87.879343,30.23859,0],[-87.893201,30.239237,0],[-87.90046,30.241531,0],[-87.913762,30.247837,0],[-87.918247,30.253308,0],[-87.936041,30.261469,0],[-87.948979,30.256564,0],[-87.966847,30.235618,0],[-88.023991,30.23039,0],[-88.029272,30.222714,0],[-88.028401,30.221132,0],[-88.014572,30.222366,0],[-87.999996,30.225753,0],[-87.962253,30.229522,0],[-87.926119,30.230373,0],[-87.838462,30.227185,0],[-87.80056,30.229365,0],[-87.73553,30.240679,0],[-87.656888,30.249709,0],[-87.581362,30.269257,0],[-87.558097,30.274437,0],[-87.544533,30.275659,0],[-87.518324,30.280435,0],[-87.51838,30.283901,0],[-87.509407,30.292188,0],[-87.466903,30.302264,0],[-87.464143,30.311797,0],[-87.485674,30.308937,0],[-87.492851,30.311797,0],[-87.496163,30.317992,0],[-87.490642,30.323234,0],[-87.481257,30.32657,0],[-87.464881,30.333298,0],[-87.462982,30.333998,0],[-87.459982,30.336298,0],[-87.452282,30.344097,0],[-87.450966,30.34626,0],[-87.451983,30.360296,0],[-87.451883,30.364996,0],[-87.451383,30.367196,0],[-87.449083,30.370396,0],[-87.441828,30.376301,0],[-87.438684,30.380794,0],[-87.438684,30.382094,0],[-87.440884,30.386694,0],[-87.441184,30.388594,0],[-87.440684,30.391494,0],[-87.437284,30.395894,0],[-87.434284,30.397494,0],[-87.431784,30.403193,0],[-87.429584,30.406493,0],[-87.426184,30.409193,0],[-87.422684,30.410093,0],[-87.419184,30.410193,0],[-87.413184,30.408993,0],[-87.408884,30.408793,0],[-87.403485,30.410193,0],[-87.401785,30.411393,0],[-87.398784,30.415093,0],[-87.395684,30.417592,0],[-87.386385,30.420492,0],[-87.382085,30.422892,0],[-87.371179,30.430485,0],[-87.368201,30.433402,0],[-87.366601,30.436643,0],[-87.366949,30.440475,0],[-87.36869,30.444625,0],[-87.370778,30.446859,0],[-87.381185,30.450091,0],[-87.391985,30.451591,0],[-87.396886,30.450591,0],[-87.399886,30.450991,0],[-87.404685,30.45289,0],[-87.407885,30.456389,0],[-87.414685,30.457289,0],[-87.425086,30.465589,0],[-87.429586,30.470588,0],[-87.430586,30.476588,0],[-87.431586,30.477688,0],[-87.434686,30.479188,0],[-87.435585,30.480488,0],[-87.432986,30.484888,0],[-87.430586,30.491087,0],[-87.431186,30.495786,0],[-87.438277,30.505348,0],[-87.439698,30.506639,0],[-87.443228,30.506772,0],[-87.444722,30.507484,0],[-87.447709,30.510448,0],[-87.447789,30.511903,0],[-87.447313,30.512619,0],[-87.446507,30.513559,0],[-87.44519,30.51397,0],[-87.444952,30.514933,0],[-87.446435,30.520296,0],[-87.446594,30.527057,0],[-87.435449,30.549129,0],[-87.434972,30.549588,0],[-87.43145,30.550252,0],[-87.4279,30.554147,0],[-87.426046,30.560061,0],[-87.423372,30.561413,0],[-87.422815,30.561367,0],[-87.422418,30.560427,0],[-87.420935,30.560656,0],[-87.418657,30.561825,0],[-87.41667,30.566294,0],[-87.416961,30.567991,0],[-87.418523,30.569549,0],[-87.418364,30.570031,0],[-87.416271,30.572436,0],[-87.414523,30.573444,0],[-87.412722,30.573215,0],[-87.408747,30.583688,0],[-87.406569,30.599915,0],[-87.404608,30.603375,0],[-87.401189,30.604383,0],[-87.399281,30.605597,0],[-87.39732,30.608714,0],[-87.395038,30.615267,0],[-87.395065,30.615886,0],[-87.396442,30.616895,0],[-87.396442,30.61772,0],[-87.395671,30.623358,0],[-87.394491,30.625178,0],[-87.393787,30.626991,0],[-87.3936,30.630865,0],[-87.395953,30.643953,0],[-87.397197,30.648101,0],[-87.396189,30.650438,0],[-87.397274,30.654335,0],[-87.400189,30.657201,0],[-87.400719,30.657132,0],[-87.405886,30.666599,0],[-87.40713,30.671779,0],[-87.406573,30.674002,0],[-87.40697,30.675148,0],[-87.412751,30.678038,0],[-87.419539,30.679964,0],[-87.424895,30.683356,0],[-87.430384,30.688627,0],[-87.436032,30.68865,0],[-87.439825,30.690461,0],[-87.442291,30.692661,0],[-87.443591,30.694586,0],[-87.449373,30.698894,0],[-87.451415,30.699787,0],[-87.456958,30.697541,0],[-87.466348,30.700816,0],[-87.467727,30.701664,0],[-87.470407,30.705262,0],[-87.474439,30.706567,0],[-87.479589,30.712845,0],[-87.479829,30.71493,0],[-87.481235,30.716488,0],[-87.487045,30.71848,0],[-87.496781,30.720333,0],[-87.497524,30.720103,0],[-87.502326,30.72157,0],[-87.505162,30.726292,0],[-87.511738,30.733514,0],[-87.523621,30.738285,0],[-87.532615,30.743467,0],[-87.535373,30.749753,0],[-87.535424,30.754738,0],[-87.536536,30.76136,0],[-87.537093,30.762507,0],[-87.542268,30.767481,0],[-87.546168,30.771997,0],[-87.545372,30.774082,0],[-87.545052,30.778642,0],[-87.552059,30.78623,0],[-87.552962,30.786917,0],[-87.554845,30.787101,0],[-87.559491,30.790423,0],[-87.560075,30.792234,0],[-87.564216,30.796221,0],[-87.568147,30.799063,0],[-87.57205,30.800507,0],[-87.576856,30.808138,0],[-87.581876,30.812377,0],[-87.587876,30.815011,0],[-87.594303,30.816958,0],[-87.600492,30.820601,0],[-87.601636,30.825113,0],[-87.603576,30.828597,0],[-87.605782,30.831277,0],[-87.610988,30.832605,0],[-87.615928,30.834666,0],[-87.615373,30.837004,0],[-87.617287,30.840326,0],[-87.624142,30.845685,0],[-87.62608,30.846466,0],[-87.627328,30.847933,0],[-87.626502,30.851852,0],[-87.625385,30.854327,0],[-87.626233,30.857099,0],[-87.62825,30.860102,0],[-87.634943,30.865857,0],[-87.629993,30.877657,0],[-87.62946,30.880085,0],[-87.624406,30.884666,0],[-87.622068,30.885378,0],[-87.620794,30.887464,0],[-87.620928,30.889893,0],[-87.622525,30.89365,0],[-87.622209,30.897478,0],[-87.620721,30.8989,0],[-87.61602,30.901423,0],[-87.614958,30.904196,0],[-87.614216,30.908505,0],[-87.611854,30.91451,0],[-87.610207,30.916597,0],[-87.608269,30.921869,0],[-87.607818,30.924459,0],[-87.602692,30.934245,0],[-87.600699,30.937042,0],[-87.598307,30.938761,0],[-87.596898,30.941099,0],[-87.592064,30.95146,0],[-87.589196,30.964431,0],[-87.590926,30.969381,0],[-87.593055,30.972933,0],[-87.59412,30.976301,0],[-87.594173,30.977538,0],[-87.592685,30.980106,0],[-87.593404,30.982925,0],[-87.596731,30.987576,0],[-87.599181,30.995688,0],[-87.598937,30.997422,0],[-87.5988285301321,30.9974236243995,0],[-87.571292,30.997836,0],[-87.548555,30.997893,0],[-87.519533,30.997552,0],[-87.480258,30.998169,0],[-87.479718,30.998164,0],[-87.478721,30.99818,0],[-87.466894,30.998145,0],[-87.466842,30.998145,0],[-87.461799,30.998168,0],[-87.461654,30.998169,0],[-87.458674,30.998353,0],[-87.455721,30.998285,0],[-87.449827,30.998239,0],[-87.432309,30.998173,0],[-87.425791,30.998058,0],[-87.367862,30.99826,0],[-87.364031,30.998187,0],[-87.355677,30.998213,0],[-87.333995,30.998241,0],[-87.312206,30.998404,0],[-87.304053,30.99816,0],[-87.30159,30.998403,0],[-87.291019,30.998322,0],[-87.288929,30.998315,0],[-87.265589,30.998237,0],[-87.260565,30.998165,0],[-87.259714,30.998142,0],[-87.257985,30.998233,0],[-87.257027,30.998164,0],[-87.255617,30.998186,0],[-87.255005,30.998255,0],[-87.237711,30.996363,0],[-87.224773,30.997139,0],[-87.1630788827798,30.9990127916141,0],[-87.162644,30.999026,0],[-87.140786,30.999503,0],[-87.125,30.998774,0],[-87.118905,30.999399,0],[-87.068667,30.999115,0],[-87.064097,30.999164,0],[-87.053772,30.999104,0],[-87.040024,30.999567,0],[-87.036402,30.999321,0],[-87.027143,30.999228,0],[-87.004396,30.999289,0],[-86.998514,30.998634,0],[-86.927851,30.997678,0],[-86.888178,30.997552,0],[-86.873032,30.997606,0],[-86.831979,30.997354,0],[-86.830542,30.997377,0],[-86.785965,30.996954,0],[-86.7856944213826,30.9969494300445,0],[-86.745289,30.996267,0],[-86.728442,30.996716,0],[-86.727343,30.996859,0],[-86.725429,30.996849,0],[-86.706312,30.99468,0],[-86.6883140179263,30.9945734725027,0],[-86.678435,30.994515,0],[-86.664734,30.994512,0],[-86.567644,30.995088,0],[-86.563494,30.995202,0],[-86.519998,30.993225,0],[-86.512894,30.99368,0],[-86.500011,30.99332,0],[-86.458382,30.993979,0],[-86.454767,30.993772,0],[-86.404977,30.994031,0],[-86.392003,30.994154,0],[-86.388713,30.994163,0],[-86.3886458727332,30.9941643948152,0],[-86.374612,30.994456,0],[-86.369337,30.994459,0],[-86.364974,30.994437,0],[-86.304666,30.994012,0],[-86.289318,30.993781,0],[-86.25652,30.993837,0],[-86.238408,30.994354,0],[-86.1872465588334,30.9940334704891,0],[-86.180308,30.99399,0],[-86.17528,30.993783,0],[-86.169055,30.993691,0],[-86.162962,30.993667,0],[-86.116997,30.992902,0],[-86.056294,30.993119,0],[-86.052544,30.993233,0],[-86.035121,30.993307,0],[-86.0350402418067,30.9933060014511,0],[-85.998727,30.992857,0],[-85.893632,30.993455,0],[-85.750028,30.994827,0],[-85.749715,30.995282,0],[-85.5794903033518,30.9963927426443,0],[-85.49838,30.996922,0],[-85.4979938168177,30.9969280044426,0],[-85.4882980047342,30.9970787565989,0],[-85.243752,31.000881,0],[-85.154576,31.000833,0],[-85.152342,31.000832,0],[-85.152209,31.000886,0],[-85.145959,31.000693,0],[-85.057662,31.000584,0],[-85.054931,31.000584,0],[-85.052217,31.000584,0],[-85.031285,31.000647,0],[-85.030237,31.000653,0],[-85.027642,31.00067,0],[-85.024238,31.000681,0],[-85.002499,31.000682,0],[-85.001497,31.005044,0],[-85.011392,31.053546,0],[-85.0235761810791,31.0755033185024,0],[-85.026603,31.080958,0],[-85.035615,31.108192,0],[-85.052867,31.119489,0],[-85.076628,31.156927,0],[-85.093405,31.162326,0],[-85.107516,31.186451,0],[-85.09977,31.209751,0],[-85.098844,31.232524,0],[-85.114548,31.276302,0],[-85.089774,31.295026,0],[-85.0888298156031,31.3086477607129,0],[-85.086657,31.339995,0],[-85.092487,31.362881,0],[-85.077581,31.398115,0],[-85.079978,31.410472,0],[-85.066005,31.431363,0],[-85.071621,31.468384,0],[-85.0455566982816,31.5171619682167,0],[-85.044986,31.51823,0],[-85.041881,31.544684,0],[-85.05796,31.57084,0],[-85.058169,31.620227,0],[-85.08096,31.653102,0],[-85.12553,31.694965,0],[-85.11893,31.732664,0],[-85.1251338538384,31.763011743932,0],[-85.12633,31.768863,0],[-85.1274996270141,31.7802526552609,0],[-85.131331,31.817562,0],[-85.141831,31.839261,0],[-85.128431,31.87756,0],[-85.114031,31.89336,0],[-85.07893,31.940159,0],[-85.067829,31.967358,0],[-85.060929,31.9900776803197,0],[-85.053815,32.013502,0],[-85.0493425460761,32.0624439732037,0],[-85.047063,32.087389,0],[-85.058749,32.136018,0],[-85.011267,32.180493,0],[-84.961728,32.19865,0],[-84.967428,32.219351,0],[-84.930127,32.219051,0],[-84.9199421479259,32.2308482009333,0],[-84.891841,32.263398,0],[-84.9338,32.29826,0],[-85.001874,32.322015,0],[-85.008096,32.336677,0],[-84.983466,32.363186,0],[-84.9834252816289,32.3777300931769,0],[-84.983386,32.391761,0],[-84.96343,32.422544,0],[-84.971831,32.442843,0],[-84.995331,32.453243,0],[-84.995231,32.475242,0],[-85.00283808653,32.5064074048035,0],[-85.0037400682779,32.5101027257633,0],[-85.0071,32.523868,0],[-85.022509,32.542923,0],[-85.069848,32.583146,0],[-85.0812838954948,32.6078405009857,0],[-85.088319,32.623032,0],[-85.105337,32.644835,0],[-85.088533,32.657958,0],[-85.093536,32.669734,0],[-85.114737,32.685634,0],[-85.122738,32.715727,0],[-85.11425,32.730447,0],[-85.11855,32.740817,0],[-85.1300975128125,32.7517487666425,0],[-85.138879,32.760062,0],[-85.122189,32.773353,0],[-85.133322,32.782078,0],[-85.167939,32.811612,0],[-85.153497,32.842781,0],[-85.1844,32.861317,0],[-85.1857897629128,32.8702674386367,0],[-85.188811,32.889725,0],[-85.221932,33.055536,0],[-85.223325,33.062578,0],[-85.232441,33.108075,0],[-85.2324414025097,33.1080770939296,0],[-85.2365689218028,33.129549211458,0],[-85.2939525862265,33.4280696299523,0],[-85.3044873227631,33.4828732747038,0],[-85.304489,33.482882,0],[-85.314048,33.529805,0],[-85.31414,33.530216,0],[-85.315043,33.535896,0],[-85.33824506153,33.6531140187301,0],[-85.357443,33.750103,0],[-85.360532,33.767957,0],[-85.361885,33.77395,0],[-85.377464,33.856046,0],[-85.3865100249673,33.9017185590001,0],[-85.398871,33.964128,0],[-85.3988712532846,33.9641292868502,0],[-85.405951,34.000099,0],[-85.406781,34.002313,0],[-85.420263,34.072277,0],[-85.4218824893099,34.0808162176071,0],[-85.428251,34.114396,0],[-85.429499,34.125095,0],[-85.455082,34.250688,0],[-85.455396,34.252853,0],[-85.458095,34.265735,0],[-85.458717,34.269436,0],[-85.4621053614252,34.2863855898362,0],[-85.470472,34.328238,0],[-85.474036379434,34.3445395457524,0],[-85.502333,34.473953,0],[-85.502471,34.474526,0],[-85.5084,34.501212,0],[-85.512124,34.518252,0],[-85.513725,34.52417,0],[-85.5137295115038,34.524190957986,0],[-85.513945,34.525192,0],[-85.517089,34.542598,0],[-85.5272733946093,34.5886802607335,0],[-85.527274,34.588683,0],[-85.5341009721027,34.62385567623,0],[-85.534339,34.625082,0],[-85.541275,34.656701,0],[-85.541278,34.656783,0],[-85.552463,34.708138,0],[-85.552491,34.708321,0],[-85.561424,34.750079,0],[-85.583148376479,34.8603678345509,0],[-85.583149,34.860371,0],[-85.595165,34.924171,0],[-85.595193,34.924331,0],[-85.598782,34.944915,0],[-85.599386,34.951766,0],[-85.605165,34.984678,0],[-85.824411,34.988142,0],[-85.828724,34.988165,0],[-85.8639354755464,34.9883790198068,0],[-86.311274,34.991098,0],[-86.3187611440952,34.9911469680432,0],[-86.397203,34.99166,0],[-86.433927,34.991085,0],[-86.467798,34.990692,0],[-86.528485,34.990677,0],[-86.555864,34.990971,0],[-86.571217,34.991011,0],[-86.588962,34.991197,0],[-86.600039,34.99124,0],[-86.641212,34.99174,0],[-86.65961,34.991792,0],[-86.670853,34.992,0],[-86.67436,34.992001,0],[-86.676726,34.99207,0],[-86.677616,34.99207,0],[-86.7836280170906,34.9919250273269,0],[-86.783648,34.991925,0],[-86.820657,34.991764,0],[-86.836306,34.991764,0],[-86.83637,34.991764,0],[-86.846466,34.99186,0],[-86.849794,34.991924,0],[-86.862147,34.991956,0],[-86.96712,34.9944,0],[-86.970236,34.994546,0],[-86.972613,34.99461,0],[-86.974412,34.994513,0],[-87.000007,34.995121,0],[-87.011174,34.995162,0],[-87.210759,34.999024,0],[-87.216683,34.999148,0],[-87.224053220297,34.9993266591169,0],[-87.230544,34.999484,0],[-87.270014,35.00039,0],[-87.299185,35.000915,0],[-87.349251,35.001662,0],[-87.359281,35.001823,0],[-87.381071,35.002118,0],[-87.391314,35.002374,0],[-87.4174,35.002669,0],[-87.421543,35.002679,0],[-87.428613,35.002795,0],[-87.606178379167,35.0036420906069,0],[-87.625025,35.003732,0],[-87.664123,35.003523,0],[-87.671405,35.003537,0],[-87.696834,35.003852,0],[-87.700543,35.003988,0],[-87.702321,35.003945,0],[-87.709491,35.004089,0],[-87.75889,35.004711,0],[-87.767602,35.004783,0],[-87.773586,35.004946,0],[-87.851886,35.005656,0],[-87.853411,35.005576,0],[-87.853528,35.005541,0],[-87.872626,35.005571,0],[-87.877742,35.005512,0],[-87.877969,35.005468,0],[-87.9849162019114,35.0058806732269,0],[-88.000032,35.005939,0],[-88.202959,35.008028,0],[-88.201987,35.005421,0],[-88.20082,34.997774,0],[-88.200064,34.995634,0],[-88.198811,34.991192,0],[-88.187429,34.974909,0],[-88.179973,34.967466,0],[-88.176106,34.962519,0],[-88.172102,34.955213,0],[-88.161594,34.933456,0],[-88.154617,34.922392,0],[-88.146335,34.914374,0],[-88.139721,34.909631,0],[-88.136692,34.907592,0],[-88.125038,34.902227,0],[-88.099999,34.894095,0],[-88.097888,34.892202,0],[-88.10756,34.811628,0],[-88.116418,34.746303,0],[-88.118407,34.724292,0],[-88.134263,34.62266,0],[-88.138719,34.589215,0],[-88.139246,34.587795,0],[-88.139988,34.581703,0],[-88.156292,34.463214,0],[-88.165634,34.383102,0],[-88.16591,34.380926,0],[-88.173632,34.321054,0],[-88.175867,34.302171,0],[-88.176889,34.293858,0],[-88.186667,34.220952,0],[-88.18762,34.204778,0],[-88.190678,34.190123,0],[-88.192128,34.175351,0],[-88.200196,34.115948,0],[-88.2037840638383,34.0865542422802,0],[-88.207229,34.058333,0],[-88.210741,34.029199,0],[-88.226428,33.912875,0],[-88.226517,33.911665,0],[-88.226517,33.911551,0],[-88.235492,33.847203,0],[-88.240054,33.810879,0],[-88.243025,33.79568,0],[-88.244142,33.781673,0],[-88.2489373465951,33.7449736777213,0],[-88.252257,33.719568,0],[-88.254445,33.698779,0],[-88.254622,33.69578,0],[-88.256131,33.68286,0],[-88.256343,33.682053,0],[-88.267005,33.594229,0],[-88.267148,33.591989,0],[-88.26816,33.58504,0],[-88.269076,33.576929,0],[-88.269532,33.572894,0],[-88.27005,33.570819,0],[-88.274619,33.534008,0],[-88.276805,33.516463,0],[-88.277421,33.512436,0],[-88.3044169870825,33.2883179507206,0],[-88.312535,33.220923,0],[-88.315235,33.203323,0],[-88.317135,33.184123,0],[-88.330934,33.073125,0],[-88.340432,32.991199,0],[-88.3478500256084,32.929077584824,0],[-88.354292,32.87513,0],[-88.368349,32.747656,0],[-88.373338,32.711825,0],[-88.382985,32.626954,0],[-88.383039,32.626679,0],[-88.3888572465182,32.5781229194103,0],[-88.399966,32.485415,0],[-88.403789,32.449885,0],[-88.403789,32.44977,0],[-88.4125,32.380025,0],[-88.413819,32.373922,0],[-88.421453,32.30868,0],[-88.428278,32.250143,0],[-88.4312940163839,32.2276546024792,0],[-88.43865,32.172806,0],[-88.43871,32.172078,0],[-88.4534176891327,32.0530497191012,0],[-88.454959,32.040576,0],[-88.455039,32.039719,0],[-88.46866,31.933173,0],[-88.468879,31.930262,0],[-88.473227,31.893856,0]]]]}};

loadJSON(url)
  .then(result => drawBoxes(result));

function loadJSON(url){
  return new Promise(resolve => {
    fetch(url)
      .then(res => res.json())
      .then(data => resolve(data))
      .catch(err => { throw err });
  })
}

function drawBoxes(data){
  // d3.queue()
  //   .defer(d3.json, stateShapes)
  //   .await(drawStates);

    for (var i = 0; i < data.length; i++) {
      let avan = AvsAnSimple.query(data[i].short_desc);
      let id = data[i]._id;
      let cord = data[i].location.coordinates;
      let state = data[i].stusps;
      console.log(state);
      placeData.push({id, cord});

      var container = document.getElementById('container');

      let box = document.createElement('div');
      box.setAttribute("class", "box "+ data[i]._id);

      let input = document.createElement('input');
      input.setAttribute("class", "toggle");
      input.setAttribute("type", "checkbox");
      input.setAttribute("id", data[i]._id);
      input.setAttribute("value", "box");
      input.onclick = function(input){
        let thisCheckbox = document.getElementById(input.target.id);
        if (thisCheckbox.checked){
          let obj = placeData.filter(function(place){return place.id == input.target.id});
          let lon = obj[0].cord[0];
          let lat = obj[0].cord[1];
          myMap.flyTo([lat, lon], 15);
        }
      }
      box.appendChild(input);

      let label = document.createElement('label');
      label.setAttribute("class", "labelHeader");
      label.setAttribute("for", data[i]._id);
      box.appendChild(label);

      let placeNameHeader = document.createElement('h1');
      placeNameHeader.textContent = data[i].name;
      placeNameHeader.setAttribute("class", "placeNameHeader");
      label.appendChild(placeNameHeader);

      let boxBody = document.createElement('div');
      boxBody.setAttribute("class", "boxBody");
      box.appendChild(boxBody);

      //let geo = topojson.feature(state, dataShape.objects.usStates).features;

      let svgBox = document.createElementNS("http://www.w3.org/2000/svg", 'svg');
      //svgBox.setAttribute("width", width);
      //svgBox.setAttribute("height", height);
      svgBox.setAttribute("class", "svgBox");
      boxBody.appendChild(svgBox);

      //let geo = topojson.feature(state, state).features;
      //console.log(geo);

      let projection = d3.geoAlbers()
                          //.translate([ 300 / 2, 150 / 2])
                          .scale(1300);

      let path = d3.geoPath()
                  .projection(projection);

      // let map = d3.select('.svgBox')
      //             .data(stateGeo)
      //             .enter().append("path")
      //             .attr("class", "state")
      //             .attr("d", path);


      d3.json("./viz/states.json", function(data) {

        let stateShape = data.objects.usStates.geometries;

        for (var i = 0; i < stateShape.length; i++) {
          console.log(stateShape[i].properties.STATE_ABBR);
        }

        // let map = d3.select('.svgBox')
        //             .data(state)
        //             .enter().append("path")
        //             .attr("class", "state")
        //             .attr("d", path);
        //
        // console.log(map);

      });



      let short_desc = document.createElement('p');
      short_desc.textContent = data[i].name + " is " + avan + " " + data[i].short_desc + ".";
      short_desc.setAttribute("class", "short_desc");
      boxBody.appendChild(short_desc);

      let long_desc = document.createElement('p');
      long_desc.textContent = data[i].long_desc;
      long_desc.setAttribute("class", "long_desc");
      boxBody.appendChild(long_desc);

      container.appendChild(box);
    }
}

// function drawStates(err, shapes){
//   console.log(shapes);
//
//
// }

function submit(){

  let loc = document.getElementById('dropdown').value;
  var search = document.getElementById('search').value;
  let placeUrl = "http://localhost:3000/api/places" + "?location=" + loc + "&search=" + search;

  let boxes = document.getElementsByClassName('box');
  for (var i = boxes.length - 1; i > -1 ; i--) {

  boxes[i].remove();

  }

  let json = loadJSON(placeUrl)
    json.then(result =>drawBoxes(result));
    json.then(result =>drawMarkers(result));
}
